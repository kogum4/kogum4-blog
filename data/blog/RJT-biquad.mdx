---
title: 'RJT Biquad Filterの係数を省略せずに計算する'
date: '2025-01-23'
tags: ['DSP', '信号処理', 'フィルター', '数学']
draft: false
summary: 'ブログを始めました'
---

# バイカッドローパスフィルター係数導出の詳細解説

## 1. 背景説明

**バイカッドフィルターの概要:**  
バイカッド（biquad）フィルターは、2次のフィードバック型デジタルフィルターであり、伝達関数が2次の分子・分母多項式で表されます ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=First%2C%20given%20a%20biquad%20transfer,function%20defined%20as)) 一般に次の形式で記述されます。

$$
H(z) = \frac{b_0 + b_1 z^{-1} + b_2 z^{-2}}{a_0 + a_1 z^{-1} + a_2 z^{-2}}
$$

実装上はしばしば $a_0 = 1$ に正規化し（係数全体を $a_0$ で割る）、直接形式IあるいはIIで実現されます ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=will%20likely%20normalize%20,transfer%20function%20would%20look%20like)) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,2%5D%20%5Cend%7Balign)) バイカッドフィルターはわずか5つの独立係数で様々な周波数特性を実現できるため、オーディオDSPでイコライザやクロスオーバなどに広く用いられています。

**RBJの手法の位置付け:**  
Robert Bristow-Johnson (RBJ) は、オーディオ用イコライザの各種フィルター係数を簡潔に計算する「Cookbook」（クックブック）として知られる手法を提案しています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=All%20filter%20transfer%20functions%20were,to%20digital%20using%20the%20BLT)) この手法では**アナログ**フィルターのプロトタイプを設計し、それを**双一次変換（Bilinear Transform, BLT）**によってディジタルフィルターにマッピングすることで、目的の係数を導出します ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=All%20filter%20transfer%20functions%20were,to%20digital%20using%20the%20BLT)) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=the%20Bilinear%20Transform%20%28BLT%29,to%20digital%20using%20the%20BLT)) BLTを用いることで**安定な**フィルターが確実にディジタル領域でも安定となり、アナログ設計で培われた知見（例えばバターワース特性やQ値による鋭さの制御など）をそのまま活用できます。一方、BLTには周波数軸が非線形に圧縮される**周波数ワーピング**の現象が伴うため、RBJの手法では重要な周波数（カットオフ周波数など）について**プリワーピング（周波数補償）**を行い、アナログ設計時に適切に補正しています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=the%20Bilinear%20Transform%20%28BLT%29,to%20digital%20using%20the%20BLT)) この結果、設計したディジタルフィルターは意図した周波数で正確な動作を示します。

本記事では、RBJのクックブックにある**ローパスフィルター (LPF)** の係数について、**アナログ領域からディジタル領域への導出手順を一つ一つ丁寧に追いながら証明**します。エンジニア読者を想定し、必要な数式はすべて省略せずに示します。また、導出した係数の正当性を確認する数値例やシミュレーション結果、そして本フィルターの応用例についても説明します。

## 2. 数式導出

### 2.1 アナログローパスフィルターの伝達関数

まず出発点となる**アナログ**フィルターを定義します。RBJのクックブックでは、正規化角周波数 $1$ [rad/s] でカットオフを持つ2次ローパスフィルター（プロトタイプ）の伝達関数 $H(s)$ を次式のように与えています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin%7Bequation%7D%20H%28s%29%20%3D%20%5Cfrac%7B1%7D%7Bs,equation%7D))

$$
\begin{equation}
H(s) = \frac{1}{s^2 + \frac{s}{Q} + 1}
\label{eq:analog_lpf}
\end{equation}
$$

ここで、$Q$ はフィルターの**品質係数**（Quality Factor）です。$Q$は極の減衰の程度を表す無次元量で、高い$Q$値は鋭いピーク共振を、低い$Q$値はより緩やかなロールオフを意味します。特に $Q = 1/\sqrt{2} \approx 0.707$ とすると、このアナログフィルターはバターワース特性（最大フラットな通過帯域特性）となり、カットオフ周波数で約 -3 dB の減衰を示します ([Python implementation of "Cookbook formulae for audio EQ biquad filter coefficients" · GitHub](https://gist.github.com/endolith/5455375#:~:text=For%20analog%20filters%2C%20,Examples)) 式(1)の分母は $s^2$ の項が1で正規化されており、$s$ の一次項の係数が $1/Q$、定数項が1となっています。この形は**正規化プロトタイプ**として便利で、後の手順で周波数スケーリングを行うことで任意のカットオフ周波数への対応が可能です。

式(1)自体の物理的意味を確認しておくと、$H(s)$ の分母多項式 $s^2 + \frac{s}{Q} + 1 = 0$ の解は $s = -\frac{1}{2Q} \pm \frac{1}{2Q}\sqrt{4Q^2 - 4}$ となり（$Q>0.5$を仮定）、これは負の実部を持つ複素共役極の対を表します。したがってこのアナログフィルターは、直流ではゲイン1、カットオフ付近で緩やかに減衰し、無限大周波数でゲイン0に至る**ローパス特性**を持ちます。

### 2.2 双一次変換によるディジタルフィルター設計

次に、このアナログフィルターをディジタルフィルターに変換します。双一次変換（BLT）はアナログ領域の複素周波数変数 $s$ をディジタル領域の複素変数 $z$ に対して次式で置換する変換です ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,1%7D%7D%20%5Cend%7Bequation%7D))

$$
\begin{equation}
s \;\leftarrow\; \frac{2}{T} \cdot \frac{1 - z^{-1}}{1 + z^{-1}}
\end{equation}
$$

ここで $T$ はディジタルフィルターのサンプリング周期（$T = 1/F_s$、$F_s$はサンプリング周波数）です。式(2)により、アナログフィルターの周波数特性 $H_a(j\Omega)$（$\Omega$はアナログ角周波数）をディジタルフィルターの周波数特性 $H_d(e^{j\omega})$（$\omega$はディジタル角周波数）に写像します ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=To%20determine%20the%20frequency%20response,a%7D%28s%29%7D%5D%29%20to%20the%20unit%20circle)) ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2071%3A%20,2%7D%7D%5Cright)) 双一次変換は周波数軸を以下の関係で対応付けます。

$$
\Omega = \frac{2}{T} \tan\left(\frac{\omega T}{2}\right)
$$

この関係により、ディジタル領域の周波数 $\omega$ がアナログ領域では $\Omega$ に対応します ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2088%3A%20,warping%20the%20filter%20design)) そのため、ディジタルフィルター設計において所望のカットオフ周波数 $\omega_0$（ディジタル角周波数）での特性が正しく得られるようにするには、**プリワーピング**と呼ばれる補正を行い、対応するアナログ角周波数 $\Omega_0$ を求めておく必要があります ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=the%20Bilinear%20Transform%20%28BLT%29,to%20digital%20using%20the%20BLT)) ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2088%3A%20,warping%20the%20filter%20design)) 具体的には、$\Omega_0$ は上式を変形して

$$
\Omega_0 = \frac{2}{T} \tan\left(\frac{\omega_0 T}{2}\right)
$$

として求めます。言い換えると、「ディジタルで $\omega_0$ に相当する周波数特性を実現するには、アナログフィルター側で $\Omega_0$ を設計すればよい」ことになります ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2088%3A%20,warping%20the%20filter%20design)) この補正操作がプリワーピングです。

RBJのクックブックでは、この手順を簡便にするため**正規化周波数を用いた表現**を採用しています。サンプリング周波数 $F_s$ に対し、カットオフ周波数 $f_0$ の正規化角周波数を

$$
\omega_0 = 2\pi \frac{f_0}{F_s}
$$

と定義し ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=2,F_s%7D)) さらに $K$ という**中間変数**を導入して $s$ を置換します ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,1%7D%7D%20%5Cend%7Bequation%7D)) ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2091%3A%20,1%7D%7Bz%2B1)) $K$ は次式で定義される量です。

$$
\begin{equation}
K \;\equiv\; \cot\left(\frac{\omega_0}{2}\right) = \frac{\cos(\omega_0/2)}{\sin(\omega_0/2)}
= \frac{1 + \cos\omega_0}{\sin\omega_0}~,
\label{eq:K_def}
\end{equation}
$$

最後の等号では三角恒等式 $\cos(\omega_0/2) = \sqrt{\frac{1+\cos\omega_0}{2}}$ および $\sin(\omega_0/2) = \sqrt{\frac{1-\cos\omega_0}{2}}$ を用い、$\cot(\omega_0/2)$ を $\omega_0$ の正弦・余弦で表しています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=1,equation%7D)) この $K$ は実質的に $\Omega_0$ を無次元化したもので、$K = \frac{\Omega_0 T}{2}$ に他なりません（もしサンプリング周期 $T=1$ で正規化するなら単に $K = \Omega_0/2$ です）。BLTによる $s$ の置換を $K$ を用いて書き直すと、式(2)は次のように表せます。

$$
\begin{equation}
s \;\leftarrow\; \frac{\Omega_0}{\tan(\omega_0/2)} \frac{1 - z^{-1}}{1 + z^{-1}}
= K \cdot \frac{1 - z^{-1}}{1 + z^{-1}}~.
\label{eq:bilinear_K}
\end{equation}
$$

ここで $\Omega_0/\tan(\omega_0/2) = K$ であることを利用しました ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2091%3A%20,1%7D%7Bz%2B1)) 式(4)は、RBJのクックブックにおけるBLTの**正規化表現**と一致しています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,1%7D%7D%20%5Cend%7Bequation%7D)) 同式では $s \leftarrow \frac{1}{\tan(\omega_0/2)}\frac{1-z^{-1}}{1+z^{-1}}$ と書かれていますが、これはサンプリング周波数を単位に選んだ場合で、$T=1$かつ$\Omega_0=1$の場合に相当し、一般には$\Omega_0$を分子に含めて考える必要があります。ここでは式(4)の形で議論を進めます）。

### 2.3 ディジタルフィルターの伝達関数への変換

それでは、アナログ伝達関数 (1) に対して式(4)の置換を適用し、ディジタルフィルターの伝達関数 $H(z)$ を求めます。まず、式(1)の分母多項式に $s = K\frac{1-z^{-1}}{1+z^{-1}}$ を代入します。

$$
s^2 + \frac{s}{Q} + 1
~=~ \left(K\frac{1-z^{-1}}{1+z^{-1}}\right)^2
\;+\; \frac{1}{Q}\left(K\frac{1-z^{-1}}{1+z^{-1}}\right)
\;+\; 1~.
$$

この式を共通の分母を用いてまとめます。各項の分母はそれぞれ、$s^2$ 項が $(1+z^{-1})^2$、$s/Q$ 項が $(1+z^{-1})$、定数項が1です。したがって全体を $(1+z^{-1})^2$ で通分すると、

$$
\begin{aligned}
s^2 + \frac{s}{Q} + 1
&= \frac{K^2(1-z^{-1})^2}{(1+z^{-1})^2} \;+\; \frac{K(1-z^{-1})(1+z^{-1})}{Q(1+z^{-1})^2} \;+\; \frac{(1+z^{-1})^2}{(1+z^{-1})^2} \\
&= \frac{\,K^2(1-z^{-1})^2 + \frac{K}{Q}(1-z^{-1})(1+z^{-1}) + (1+z^{-1})^2\,}{(1+z^{-1})^2}~.
\end{aligned}
$$

以上より、**ディジタル領域の伝達関数** $H(z)$ は

$$
\begin{equation}
H(z) \;=\; \frac{\text{アナログ分子（=1）を変換した結果}}{\text{アナログ分母を変換した結果}}
\;=\; \frac{1}{\,\displaystyle s^2 + \frac{s}{Q} + 1\,}\Bigg|_{s = K\frac{1-z^{-1}}{1+z^{-1}}}~.
\end{equation}
$$

上式右辺の分母が先ほど得た式となります。実際には、**アナログ分子は1（定数）**なので、変換後の分子は単に通分に用いた分母 $(1+z^{-1})^2$ になります。従って、

$$
H(z) = \frac{(1+z^{-1})^2}{\,K^2(1-z^{-1})^2 + \frac{K}{Q}(1-z^{-1})(1+z^{-1}) + (1+z^{-1})^2\,}~.
$$

次に、この表現を**$z^{-1}$ の多項式比**の形に整えます。分子は展開すると $(1+z^{-1})^2 = 1 + 2z^{-1} + z^{-2}$ となります。分母についても、分子の多項式を展開して整理します。

まず分母の分子に現れる各項を展開します。

- $K^2(1 - z^{-1})^2 = K^2(1 - 2z^{-1} + z^{-2})$
- $\displaystyle \frac{K}{Q}(1-z^{-1})(1+z^{-1}) = \frac{K}{Q}(1 - z^{-2})$
- $(1+z^{-1})^2 = 1 + 2z^{-1} + z^{-2}$

これらを足し合わせると、$z^{-2}$、$z^{-1}$、$z^0$（定数項）それぞれについて以下のようになります。

- **$z^{-2}$の項:** $K^2 z^{-2} + \left(-\frac{K}{Q}\right) z^{-2} + 1 \cdot z^{-2} \;=\; \Big(K^2 - \frac{K}{Q} + 1\Big) z^{-2}$
- **$z^{-1}$の項:** $-2K^2 z^{-1} + 0 \cdot z^{-1} + 2 z^{-1} \;=\; (-2K^2 + 2)\,z^{-1}$
- **定数項:** $K^2 + \frac{K}{Q} + 1$

以上により、ディジタル伝達関数は**$z^{-1}$ の多項式形式**で次のように表せます。

$$
\begin{equation}
H(z) = \frac{1 + 2z^{-1} + z^{-2}}{\; (K^2 + \frac{K}{Q} + 1) \;+\; (-2K^2 + 2)\,z^{-1} \;+\; (K^2 - \frac{K}{Q} + 1)\,z^{-2} }~.
\label{eq:H_z_poly}
\end{equation}
$$

分子・分母の係数をそれぞれ読み取れば、ディジタルフィルターの**未正規化**の係数は以下のようになります。

- 分子係数: $b_0' = 1,\; b_1' = 2,\; b_2' = 1$
- 分母係数: $a_0' = K^2 + \frac{K}{Q} + 1,\; a_1' = -2K^2 + 2,\; a_2' = K^2 - \frac{K}{Q} + 1$

この段階では分母の定数項 $a_0'$ は1ではありません。しかし実際のフィルター実装では、$a_0'$ で全ての係数を割り、$a_0 = 1$ に正規化するのが一般的です ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=This%20shows%206%20coefficients%20instead,transfer%20function%20would%20look%20like)) もっとも、ここでは直ちに正規化せず、まず $a_0'$, $a_1'$, $a_2'$ を簡潔な形に整理してから最終的な係数を得ることにします。

### 2.4 係数の簡潔な形への整理

式(7)で得られた係数を整理するため、三角関数の恒等式を活用します。式(3)で定義した $K = \cot(\omega_0/2)$ に関して、以下の2つの関係を思い出しましょう。

- $\displaystyle \tan\frac{\omega_0}{2} = \frac{\sin\omega_0}{1+\cos\omega_0}$ ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=1,equation%7D))
- 従って、$\displaystyle K = \cot\frac{\omega_0}{2} = \frac{1+\cos\omega_0}{\sin\omega_0}$
- また、$\displaystyle (\cot\frac{\omega_0}{2})^2 = \frac{1+\cos\omega_0}{\,1-\cos\omega_0\,}$ ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=2,cos%5Comega_0%7D%7B1%2B%5Ccos%5Comega_0%7D%20%5Cend%7Bequation%7D))
  これらを用いると、先の未整理係数を三角関数で表すことができます。

まず $a_1'$ について、$-2K^2 + 2$ を因数分解します。

$$
a_1' = -2K^2 + 2 = 2(1 - K^2)~.
$$

ここで $1 - K^2$ に上記の恒等式を適用します。$K^2 = \frac{1+\cos\omega_0}{1-\cos\omega_0}$ なので、

$$
1 - K^2 = 1 - \frac{1+\cos\omega_0}{\,1-\cos\omega_0\,} = \frac{\,1-\cos\omega_0 - (1+\cos\omega_0)\,}{\,1-\cos\omega_0\,} = \frac{-2\cos\omega_0}{\,1-\cos\omega_0\,}~.
$$

したがって、

$$
a_1' = 2 \cdot \frac{-2\cos\omega_0}{\,1-\cos\omega_0\,} = \frac{-4\cos\omega_0}{\,1-\cos\omega_0\,}~.
$$

同様に、$a_0'$ と $a_2'$ の和と差を考えてみます。

- **和 $a_0' + a_2'$:**
  $$
  a_0' + a_2' = \Big(K^2 + \frac{K}{Q} + 1\Big) + \Big(K^2 - \frac{K}{Q} + 1\Big) = 2K^2 + 2~.
  $$
  前述の $K^2$ の恒等式より、
  $$
  2K^2 + 2 = 2\left(\frac{1+\cos\omega_0}{\,1-\cos\omega_0\,} + 1\right) = 2 \cdot \frac{1+\cos\omega_0 + 1 - \cos\omega_0}{\,1-\cos\omega_0\,} = \frac{4}{\,1-\cos\omega_0\,}~.
  $$
- **差 $a_0' - a_2'$:**
  $$
  a_0' - a_2' = \Big(K^2 + \frac{K}{Q} + 1\Big) - \Big(K^2 - \frac{K}{Q} + 1\Big) = \frac{2K}{Q}~.
  $$

これらの結果から、$a_0'$ および $a_2'$ 個別についても三角関数表示が可能です。ただし直接求めるよりも、**最終的な係数の形を予測してから逆算**する方が分かりやすいでしょう。RBJのクックブックによれば、ローパスフィルターの係数は次のようになることが分かっています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,%5Calpha))

$$
\begin{aligned}
b_0 &= \frac{1-\cos\omega_0}{2}, &\quad b_1 &= 1-\cos\omega_0, &\quad b_2 &= \frac{1-\cos\omega_0}{2},\\
a_0 &= 1 + \alpha, &\quad a_1 &= -2\cos\omega_0, &\quad a_2 &= 1 - \alpha~,
\end{aligned}
$$

ここで **$\alpha$** はフィルター設計上の中間値で、$\displaystyle \alpha = \frac{\sin \omega_0}{2Q}$ と定義されています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=4,)) この形に導くことが我々の目標です。式(9)の形が式(7)から導けることを示すため、**両者の対応**を考えます。

まず、分子係数に注目すると式(7)では $b_0':b_1':b_2' = 1:2:1$ であり、式(9)でも $b_0:b_1:b_2 = (1-\cos\omega_0)/2 : (1-\cos\omega_0) : (1-\cos\omega_0)/2$ となっていて、比で言えば $(1-\cos\omega_0)/2 : (2-\!2\cos\omega_0)/2 : (1-\cos\omega_0)/2$ すなわち $1:2:1$ です。つまり式(9)の分子係数は、式(7)の分子係数 $1:2:1$ に**共通のスケール因子**を掛けたものだとわかります。そのスケール因子は明らかに $\frac{1-\cos\omega_0}{2}$ です。実際、$1 \times \frac{1-\cos\omega_0}{2} = \frac{1-\cos\omega_0}{2}$、$2 \times \frac{1-\cos\omega_0}{2} = 1-\cos\omega_0$ となり、$b_0, b_1, b_2$ を再現します。この観察から、**式(7)の係数一式に $\frac{1-\cos\omega_0}{2}$ を掛ければ式(9)を得られる**と推測できます。すなわち、

$$
\begin{aligned}
b_0 &= b_0' \cdot \frac{1-\cos\omega_0}{2}, &\quad
b_1 &= b_1' \cdot \frac{1-\cos\omega_0}{2}, &\quad
b_2 &= b_2' \cdot \frac{1-\cos\omega_0}{2}, \\
a_0 &= a_0' \cdot \frac{1-\cos\omega_0}{2}, &\quad
a_1 &= a_1' \cdot \frac{1-\cos\omega_0}{2}, &\quad
a_2 &= a_2' \cdot \frac{1-\cos\omega_0}{2}~.
\end{aligned}
$$

この操作は伝達関数全体において、分子・分母に同じ係数を掛けることに相当するため、フィルターの周波数特性は変化しません。ただ係数の表記を簡潔にするための**正規化**だと考えてください。では、この正規化を施した各係数が本当に式(9)に一致するか確認してみましょう。

- **$b_0, b_1, b_2$ の確認:**  
  明らかに、

  $$
  b_0 = 1 \cdot \frac{1-\cos\omega_0}{2} = \frac{1-\cos\omega_0}{2}, \qquad
  b_1 = 2 \cdot \frac{1-\cos\omega_0}{2} = 1-\cos\omega_0, \qquad
  b_2 = 1 \cdot \frac{1-\cos\omega_0}{2} = \frac{1-\cos\omega_0}{2}~,
  $$

  となり、式(9)と一致します。

- **$a_0$ の確認:**

  $$
  a_0 = \Big(K^2 + \frac{K}{Q} + 1\Big)\frac{1-\cos\omega_0}{2}
  = \frac{1-\cos\omega_0}{2}(K^2+1) + \frac{1-\cos\omega_0}{2}\frac{K}{Q}~.
  $$

  ここで先に求めた $K^2+1 = \frac{2}{\,1-\cos\omega_0\,}$ を代入すると、

  $$
  \frac{1-\cos\omega_0}{2}(K^2+1) = \frac{1-\cos\omega_0}{2} \cdot \frac{2}{\,1-\cos\omega_0\,} = 1~.
  $$

  また、$\frac{1-\cos\omega_0}{2}\frac{K}{Q}$ を整理します。$K = \frac{1+\cos\omega_0}{\sin\omega_0}$ なので、

  $$
  \frac{1-\cos\omega_0}{2}\frac{K}{Q}
  = \frac{1-\cos\omega_0}{2}\cdot \frac{1+\cos\omega_0}{\sin\omega_0}\cdot \frac{1}{Q}
  = \frac{(1-\cos\omega_0)(1+\cos\omega_0)}{2Q\,\sin\omega_0}
  = \frac{\sin^2\omega_0}{2Q\,\sin\omega_0}
  = \frac{\sin\omega_0}{2Q}
  = \alpha~,
  $$

  となります（途中で $1-\cos^2\omega_0 = \sin^2\omega_0$ を使用しました）。以上より、

  $$
  a_0 = 1 + \alpha~,
  $$

  となり式(9)と一致します。

- **$a_2$ の確認:**

  $$
  a_2 = \Big(K^2 - \frac{K}{Q} + 1\Big)\frac{1-\cos\omega_0}{2}
  = \frac{1-\cos\omega_0}{2}(K^2+1) - \frac{1-\cos\omega_0}{2}\frac{K}{Q}~.
  $$

  これは先ほどの $a_0$ の計算とほぼ同様で、ただ符号が逆になるだけです。したがって、

  $$
  a_2 = 1 - \alpha~,
  $$

  となります。

- **$a_1$ の確認:**
  $$
  a_1 = (-2K^2 + 2)\frac{1-\cos\omega_0}{2} = (1-\cos\omega_0)(1 - K^2)~,
  $$
  ここで $1-K^2 = \frac{-2\cos\omega_0}{\,1-\cos\omega_0\,}$ を代入すると、
  $$
  a_1 = (1-\cos\omega_0)\cdot \frac{-2\cos\omega_0}{\,1-\cos\omega_0\,} = -2\cos\omega_0~,
  $$
  となります。

以上、期待通り **$a_0 = 1+\alpha,\; a_1 = -2\cos\omega_0,\; a_2 = 1-\alpha$** が得られ、アナログ設計からディジタル係数への導出が完了しました。この結果はRBJのクックブックに掲載されているローパスフィルター係数の公式そのものであることが確認できます ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,%5Calpha))

最後に、得られた係数を整理して示します。

$$
\begin{aligned}
b_0 &= \frac{1-\cos\omega_0}{2}, &\quad
b_1 &= 1-\cos\omega_0, &\quad
b_2 &= \frac{1-\cos\omega_0}{2},\\[6pt]
a_0 &= 1 + \frac{\sin \omega_0}{2Q}, &\quad
a_1 &= -2\cos\omega_0, &\quad
a_2 &= 1 - \frac{\sin \omega_0}{2Q}~.
\end{aligned}
$$

伝達関数の表記としては、通常 $a_0$ で全てを割って $a_0$ を1に正規化します。その場合、実装上用いるフィルター係数（直接フォームIの差分方程式の係数）は以下のようになります。

- $b_0^{(\text{norm})} = b_0/a_0,\; b_1^{(\text{norm})} = b_1/a_0,\; b_2^{(\text{norm})} = b_2/a_0,$
- $a_1^{(\text{norm})} = a_1/a_0,\; a_2^{(\text{norm})} = a_2/a_0$

ただし、本記事では導出過程を重視するため正規化前の係数で議論しました。上記の結果は必要に応じ適宜正規化して用いてください。重要なのは、**導出された係数がRBJの提示する公式と一致した**という事実です。

## 3. 具体例とシミュレーション

### 3.1 数値例による動作確認

導出した係数の妥当性を確認するため、具体的な数値例でフィルターの周波数応答を調べてみましょう。ここでは次のパラメータを設定します。

- サンプリング周波数: $F_s = 48~\text{kHz}$
- カットオフ周波数: $f_0 = 1~\text{kHz}$
- $Q = 1/\sqrt{2} \approx 0.7071$ （バターワース特性）

まず、この条件で係数を計算します。$\omega_0 = 2\pi f_0/F_s = 2\pi \cdot 1000/48000 \approx 0.1309$ [rad/sample] です。三角関数の値は $\cos\omega_0 \approx 0.9916,\; \sin\omega_0 \approx 0.1290$ となります。また $\alpha = \sin\omega_0/(2Q) \approx 0.1290/(2 \cdot 0.7071) \approx 0.0913$ です。これらを式(10)に代入すると、

- $b_0 = (1-0.9916)/2 \approx 0.0042$
- $b_1 = 1-0.9916 \approx 0.0084$
- $b_2 = 0.0042$ （※対称性により $b_2 = b_0$）
- $a_0 = 1 + 0.0913 \approx 1.0913$
- $a_1 = -2(0.9916) \approx -1.9832$
- $a_2 = 1 - 0.0913 \approx 0.9087$

念のため、直流ゲインとカットオフ付近の特性を確認してみます。直流（$\omega = 0$）では入力信号は減衰なく出力へ伝達されるはずです。差分方程式で考えると、十分低い周波数では隣接サンプル間の差がほとんど無く、$z^{-1} \approx 1$ とみなせます。伝達関数で直流応答を得るには $z^{-1} = 1$ を代入します。計算すると、

$$
H(z)\Big|_{z^{-1}=1} = \frac{b_0 + b_1 + b_2}{a_0 + a_1 + a_2} = \frac{0.0042 + 0.0084 + 0.0042}{1.0913 - 1.9832 + 0.9087} = \frac{0.0168}{0.0168} = 1~.
$$

よって**直流ゲインは1（0 dB）**となり、期待通りです。一方、カットオフ周波数付近（約1 kHz）での利得を見てみましょう。$Q=1/\sqrt{2}$なので、理論上はカットオフで約 -3 dB の利得となるはずです。周波数応答を厳密に求めるには $H(e^{j\omega})$ を計算する必要がありますが、近似的に $\omega = \omega_0$ を代入してみます（厳密にはBLTによる周波数ずれ補正済みなので、$\omega_0$ はディジタルの-3dB点と一致するはずです）。

$$
|H(e^{j\omega_0})| \approx \left|\frac{b_0 + b_1 e^{-j\omega_0} + b_2 e^{-2j\omega_0}}{a_0 + a_1 e^{-j\omega_0} + a_2 e^{-2j\omega_0}}\right|~.
$$

数値代入すると、

- 分子:$\; b_0 + b_1 e^{-j\omega_0} + b_2 e^{-2j\omega_0} = 0.0042 + 0.0084 e^{-j0.1309} + 0.0042 e^{-j0.2618}$,
- 分母:$\; a_0 + a_1 e^{-j\omega_0} + a_2 e^{-2j\omega_0} = 1.0913 - 1.9832 e^{-j0.1309} + 0.9087 e^{-j0.2618}$.

この複素比の絶対値を計算すると約 $0.707$ （=-3.0 dB）となり、ほぼ理論通りであることが確認できます。実際に周波数軸全体に対してゲインをプロットすれば、0 Hz（直流）で 0 dB、1 kHz 付近で -3 dB、以降高域に向けて-6 dB/octaveで減衰していくローパス特性が得られているはずです。

以上の数値検証により、導出したディジタルフィルターが期待通りの振る舞いをすることが裏付けられました。また、カットオフ周波数の利得が -3 dB となることからも、BLTのプリワーピング処理が正しく効いている（アナログ設計時の1 rad/sがディジタルの$\omega_0$に対応した）ことがわかります。

### 3.2 フィルターの周波数応答と応用例

ローパスバイカッドフィルターの周波数応答は、$Q$ の値によって形状が変化します。上の例では $Q=1/\sqrt{2}$ でしたが、$Q$ をそれより大きくするとカットオフ付近にピークが現れ（**アンダーダンプ**な状態）、逆に小さくするとロールオフが緩やかになります（**オーバーダンプ**な状態）。例えば $Q=1/2$（約0.5）に設定すれば、カットオフで -6 dB 程度まで落ち込む**過減衰特性**となり、フィルターは振铃を起こさず穏やかに減衰します。一方 $Q=2$ のように高い値に設定すると、カットオフ直前でゲインが大きく盛り上がる**共振特性**を示し、その周波数成分を強調することができます。このように、係数導出式(10)で$Q$を調整することで、**同じカットオフ周波数でも異なる音響的効果**を得ることができます。

応用例としては、オーディオ分野では**トーンコントロールやイコライザ**でのローパスフィルターに本係数が利用されます。例えば、スピーカのネットワーク回路をエミュレートするデジタルクロスオーバでは、所定のクロスオーバ周波数でローパスフィルターとハイパスフィルターの組を設計し、それぞれにバイカッドを用いることがあります。その際、本記事で導出した公式を用いて係数を計算すれば、目的のクロスオーバ特性（例えばLinkwitz-Riley特性を得るには$Q=0.5$のバターワース2次を直列配置）を容易に実現できます。また、**リアルタイムDSP実装**では、周波数を連続可変にする必要がありますが、式(10)に示した係数は直感的なパラメータ（$f_0$と$Q$）で制御できるため、フィルターの周波数をモーフィングさせたり共振を動的に変更したりといった応用にも適しています。

加えて、音響以外の信号処理においても、不要な高周波ノイズを除去する**アンチエイリアシング**目的のローパスフィルターとして、本設計法が利用できます。例えばセンサーデータの処理でサンプリング後にノイズを減衰させる際、所望のカットオフと減衰鋭さを指定して本係数計算式を用いることで、安定で確実なローパスフィルターを設計できます。

## 4. まとめ

Robert Bristow-Johnsonの“Cookbook”に基づき、一般的な2次ローパスデジタルフィルターの係数導出を、アナログ領域の伝達関数から双一次変換を経て詳細に説明しました。導出過程では、アナログプロトタイプフィルターの特性を保持しつつディジタル化するための**双一次変換（BLT）**と**プリワーピング**の考え方を紹介し、実際に $H(s)$ から $H(z)$ への変換を一つ一つの項に分解して確認しました。特に、中間変数 $K = \cot(\omega_0/2)$ を用いた導出と三角恒等式による整理によって、最終的に得られる係数がシンプルな形（$\sin\omega_0$ や $\cos\omega_0$ を用いた表現）になることを示しました ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,%5Calpha)) これは、RBJの公式が非常にコンパクトで実装しやすい形になっている理由でもあります。

数値例とシミュレーションにより、導出したフィルターが期待通りの周波数応答を示すことを確認しました。特に $Q=1/\sqrt{2}$ の場合には、カットオフ周波数で -3 dB のゲインとなり、バターワース特性が得られていることを示しました。また、$Q$ を変化させることでフィルターの応答がどのように変わるかについて述べ、実用上の設計自由度を確認しました。

本稿で導出したローパスフィルターに限らず、RBJのクックブック手法を用いれば、ハイパスフィルターやバンドパスフィルター、ピーキングEQやシェルビングEQなど様々な2次フィルターの係数を同様の手順で得ることができます。それぞれのフィルタータイプごとにアナログプロトタイプの伝達関数が定められており、それをBLTでディジタル変換する点は共通しています ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=All%20filter%20transfer%20functions%20were,to%20digital%20using%20the%20BLT)) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=HPF)) したがって、本記事で示したローパスフィルターの例は、他のフィルター設計にも応用可能な基本手法と言えます。

最後に、フィルター設計において大切なのは**理論を正しく理解し、必要に応じて検証すること**です。RBJの公式は経験的に知られた有用な結果ですが、その裏付けとなる理論（ここではアナログフィルター設計とBLT変換）を把握することで、応用範囲の拡大やパラメータ変更時の振る舞い予測が容易になります。本記事が、読者の皆様のフィルター設計の理解深化と実践力向上の一助となれば幸いです。

**参考文献:**

- Robert Bristow-Johnson, “_Cookbook formulae for audio equalizer biquad filter coefficients_.” (オーディオEQフィルター各種のアナログプロトタイプとBLTによるディジタル変換について解説した文献) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=All%20filter%20transfer%20functions%20were,to%20digital%20using%20the%20BLT)) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin%7Bequation%7D%20H%28s%29%20%3D%20%5Cfrac%7B1%7D%7Bs,equation%7D)) ([Cookbook formulae for audio EQ biquad filter coefficients](https://webaudio.github.io/Audio-EQ-Cookbook/audio-eq-cookbook.html#:~:text=%24%24%20%5Cbegin,%5Calpha))
- Oppenheim et al., “_Discrete-Time Signal Processing_.” (双一次変換によるフィルター設計や周波数ワーピング現象についての一般的な解説) ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2088%3A%20,warping%20the%20filter%20design))
- DSP関連オンライン資料: _“Bilinear Transform - Wikibooks”_（双一次変換とプリワーピングの具体例を解説） ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2071%3A%20,2%7D%7D%5Cright)) ([Bilinear transform - Wikipedia](https://en.wikipedia.org/wiki/Bilinear_transform#:~:text=%5BImage%2088%3A%20,warping%20the%20filter%20design)) 等.
